name: Update Twitter Photo Cache Weekly
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * 0' # every sunday at midnight

jobs:
  update-cache:
    runs-on: ubuntu-latest
    # Add these permissions
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v3

      - name: Update Twitter photo cache
        uses: ./
        with:
          TWITTER_BEARER_TOKEN: ${{ secrets.TWITTER_BEARER_TOKEN }}

      # Add this step to configure git
      - name: Configure git
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        shell: bash

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update Twitter photo cache
          title: 'Update Twitter Photo Cache'
          body: 'This is an auto-generated PR with the latest Twitter photo cache.'
          branch: 'twitter-cache'
          base: 'main'